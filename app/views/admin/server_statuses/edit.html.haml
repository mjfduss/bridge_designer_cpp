%h1 Server status at #{Time.now.to_s(:nice)} from client #{@ip}
- a_day_ago = 24.hours.ago
%table
  %tr
    %td Reminder requests:
    %td= ReminderRequest.count
  %tr
    %td Teams:
    %td
      #{Team.count}
      (#{Team.joins(:designs).count(:id, :distinct => true)} with designs,
      #{Team.joins(:designs).where("status = 'r'").count(:id, :distinct => true)} rejected)
  %tr
    %td ...last 24 hours:
    %td
      #{Team.where(['reg_completed >= ?', a_day_ago]).count}
      (#{Team.joins(:designs).where(['reg_completed >= ?', a_day_ago]).count(:id, :distinct => true)} with designs)
  %tr
    %td Designs:
    %td= Design.count
  %tr
    %td ...last 24 hours:
    %td= Design.where(['created_at >= ?', a_day_ago]).count
  %tr
    %td Standings:
    %td
      - s = %w{h m i}.map { |c| Standing.score_count(c) }
      High school: #{s[0]}
      |
      Middle school: #{s[1]}
      |
      Open: #{s[2]}
      |
      Total: #{s.inject(0, :+)}
  %tr
    %td Local Contests:
    %td= LocalContest.count
  - if LocalScoreboard.first
    %tr
      %td Local scoreboard update:
      %td= LocalScoreboard.maximum(:updated_at).to_s(:nice)
%hr
%h1 Clear contest database
= render :partial => 'shared/flash', :locals => { :flash => flash, :errors => [] }
.para
  Use the button below with extreme care.  Once cleared,
  the database can be restored only from backups.  This
  may lose several hours of contest submissions.

= form_tag({:controller => :server_statuses, :action => :update }, :method => :put) do
  .para
    Type the word
    %span.bold #{Admin::ServerStatusesController::VERIFICATION}
    in the box below.
  = text_field_tag('verification')
  .para Type your password in the box below.
  = password_field_tag('password')
  .para
  = submit_tag('Clear database now',
    :confirm => 'I am ABSOLUTELY SURE that I want to clear the entire database!')


